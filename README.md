# 2022科大讯飞 AI 开发者大赛 -- 基于论文摘要的文本分类与查询性问答

团队名：菜的 [MASK] 明显

最终排名：第二名

答辩 PPT：[PPT](【算法赛决赛-基于论文摘要的文本分类与查询性问答赛道-第二名-答辩材料】.pptx)

知乎 Link：[Link](https://zhuanlan.zhihu.com/p/630098432)

这个仓库是我们团队在 [2022科大讯飞 AI 开发者大赛 -- 基于论文摘要的文本分类与查询性问答](https://challenge.xfyun.cn/topic/info?type=abstract&option=phb) 比赛中取得第二名结果的相关文件及代码开源，包含我们完成本次比赛的完整思路和复现代码。

## 一、解决方案

本任务为文本分类任务，需要将给定的文献摘要分类的特定的类别。

我们整体的解决思路是：

（1）数据预处理：删除了 \n 换行符，制作 k-fold 数据；

（2）训练：使用多个预训练模型训练 k-fold 数据集；

（3）测试：投票融合 k-fold 模型和多模型结果。


### 数据预处理

（1）因为训练验证集和测试集数据存在重复，我们制作了两份数据集，一份不删除训练集中的和测试集重复样本，另一份删除；

（2）每份数据使用 title 和 abstract 删除 \n 换行符，制作 k-fold 数据集；

（3）尝试了其它数据清洗（eg：只保留字符类），数据增强（eda），k-fold 模型清理明显不正确 label，k-fold 模型构建测试集伪标签，使用 doi，author，label等字段，都没有取得提升；

### 训练

（1）使用不同的预训练模型分别训练 k-fold 数据集；

（2）尝试后有效的 tricks：FGM 和 PGD 对抗训练，Weight Decay，Linear Schedualer，调大 Classifier 层学习率；

（3）尝试后无效的 tricks：MLM 后训练（使用数据增强数据），FP16，Warmup，Cosine Schedular，分别设置预训练模型不同层的学习率，EMA，R-Drop，Multi Sample Dropout，使用最后一层隐状态平均做分类，Mixup数据增强（Embedding 层，中间层，输出层）；

### 预测

（1）方案1：使用首先 k-fold 模型预测投票，然后多模型预测结果使用线上得分加权投票的方式得到最终结果；

（2）方案2：改进方案1，针对训练测试集中的重叠样本，由于训练集标注基本不正确，所以首先自动检测这部分样本，然后对这部分样本使用预测 logits 第二大的标签作为最终结果，有明显提升；

## 二、复现流程

### 1. 实验环境

```
cuda==11.2
python==3.8.13
GPU型号==GeForce RTX 2080Ti*8张
```

### 2. 运行流程

```
首先安装号对应环境，进入 project 目录
cd code
bash preprocess.sh  # 获取处理后数据，即 ./user_data 目录下的两个数据文件夹
bash train.sh  # 训练全流程，会顺序运行 6 个模型的训练脚本，前两个 large 模型训练为 8 卡，后 6 个 base 模型训练为单卡，如果需要提升速度，可以分别在不同的卡上运行这 6 个模型的训练脚本，需要在 6 个脚本中分别指定不同的 GPU 卡号
bash test.sh  # 测试全流程，会顺序执行 6 个模型的测试脚本，并且实现 k-fold 以及多模型融合，最终的结果位于 ./prediction_result/result.csv
```

### 3. 备注：

（1）所有使用的模型均为 Hugging face 直接下载的模型（代码中用模型名字自动下载），所有使用的数据均为比赛数据；

（2）数据处理产生的中间数据已经给出（./user_data/），可以直接使用，或者按照上述标准步骤重新生成；

（3）./code/result 用于存放模型训练结果；./code/submit 用于存放中间预测结果，目前该文件夹中以给出参赛预测的中间结果，可以按照上述标准步骤重新生成，也可以直接使用 model_ensemble.py 获得最终提交结果；
